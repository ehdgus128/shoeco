<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.shoeco.shoeco.common.mapper.SCListMapper">

<!-- 230808 세연 / 배너 눌렀을때 리스트랑 사진 나오는것 (카테고리별 분류) -->
<!--  	<select id="selectCategoryList">
	SELECT a.prodCode, a.brandCode, a.prodName, a.gender, a.sellPrice, a.category, a.material, a.country,
	   	   b.prodUploadPath, b.prodFileType FROM SC_PRODUCTS a JOIN SC_PRODUCTS_ATTACHMENTS b ON (a.prodCode = b.prodCode) 
	   	   WHERE a.category = #{category}   
	</select>
 --> 

<!-- 1 성별에 따른 카테고리 where gender 추가하고 나중에 jsp 브랜드별로 따로만듬  -->

<!-- 230810 아직 미완성: 카테고리, 검색어, 페이징 고려 mapper-->
	<select id="selectCategoryList">
	Select distinct a.prodCode from SC_PRODUCTS a join SC_PRODUCTS_OPTION b on(a.prodCode  = b.prodCode) <!-- 사진 자료 생기면 쓰고 이거대신 옵션 테이블 --> 
								 join SC_BRAND c on(a.brandCode= c.brandCode) 
	 <where>
	 	 <!-- 테스트 중 -->
	 	  <if test="gender != null">	
	 	   a.gender = #{gender}
	 	  </if>
	 	 <!--  -->
	 
		 <if test="paging.category != null">		 
		 	a.category = #{paging.category} 	
		 </if>
		 
		 <if test="paging.keyword !=null">
		 	 
			  a.prodCode LIKE '%'||#{paging.keyword}||'%' OR 
			  <!-- brand가 나중에 join하게 되면 추가 brandName LIKE '%'||#{paging.keyword}||'%' OR  -->
			  a.prodName LIKE '%'||#{paging.keyword}||'%' OR 
			  c.brandName LIKE '%'||#{paging.keyword}||'%' OR 
			  a.category LIKE '%'||#{paging.keyword}||'%' 
			  
		 </if>
		
		  
	 	  <if test="paging.sizeArray != null">
			 <foreach item="size" collection="paging.sizeArray" open="(" close=")" separator="OR">
		 			a.prodSize = CAST (#{size} AS INTEGER) 
			 </foreach>
			 
		  </if>
		
		
		 <if test="paging.colorArray != null ">
		 	<foreach item="color" collection="paging.colorArray" open="(" close=")" separator="OR">
				a.color= #{color}
			</foreach>
		 </if>
		 
		 <if test="paging.brandArray != null ">
		 	<foreach item="brand" collection="paging.brandArray" open="(" close=")" separator="OR">
				a.brandName= #{brand}
			</foreach>
		 </if>
		    
	 </where>
		Order by 
		<choose>
		 <when test="paging.arraykeyword == null">
		 1 DESC 
		
		
		</when>
		<otherwise>
		  # { paging.arraykeyword} DESC 
		
		
		</otherwise>
		
		
		</choose>
	
	</select>

<!--2 rowTotal 페이징고려해야함  -->

 	<select id="selectRowTotal">
	Select COUNT(*) from SC_PRODUCTS a join SC_PRODUCTS_OPTION b on(a.prodCode  = b.prodCode) <!-- 사진 자료 생기면 쓰고 이거대신 옵션 테이블 --> 
								 join SC_BRAND c on(a.brandCode= c.brandCode) 
	 <where>
	 	 <!-- 테스트 중 -->
	 	    <if test="gender != null">	
	 	 	  a.gender = #{gender}
	 	  	</if>
	 	 <!--  -->
	 	
		 <if test="paging.category != null">		 
		 	a.category = #{paging.category} 	
		 </if>
		 
		 <if test="paging.keyword !=null">
		 	 
			  a.prodCode LIKE '%'||#{paging.keyword}||'%' OR 
			  <!-- brand가 나중에 join하게 되면 추가 brandName LIKE '%'||#{paging.keyword}||'%' OR  -->
			  a.prodName LIKE '%'||#{paging.keyword}||'%' OR 
			  c.brandName LIKE '%'||#{paging.keyword}||'%' OR 
			  a.category LIKE '%'||#{paging.keyword}||'%' 
			  
		 </if>
		
		  
	 	  <if test="paging.sizeArray != null">
			 <foreach item="size" collection="paging.sizeArray" open="(" close=")" separator="OR">
		 			a.prodSize = CAST (#{size} AS INTEGER) 
			 </foreach>
			 
		  </if>
		
		
		 <if test="paging.colorArray != null ">
		 	<foreach item="color" collection="paging.colorArray" open="(" close=")" separator="OR">
				a.color= #{color}
			</foreach>
		 </if>
		 
		 <if test="paging.brandArray != null ">
		 	<foreach item="brand" collection="paging.brandArray" open="(" close=")" separator="OR">
				a.brandName= #{brand}
			</foreach>
		 </if>
		    
	 </where>
		Order by 
		<choose>
		 <when test="paging.arraykeyword == null">
		 1 DESC 
		
		
		</when>
		<otherwise>
		  # { paging.arraykeyword} DESC 
		
		
		</otherwise>
		
		
		</choose>
	
	</select>
 


<!--3번째 mapper range범위의 최솟값  -->
 


 
<select id="selectMinPrice">
	 SELECT MIN(sellPrice) from SC_PRODUCTS a join SC_PRODUCTS_OPTION b on(a.prodCode  = b.prodCode) <!-- 사진 자료 생기면 쓰고 이거대신 옵션 테이블 --> 
								 join SC_BRAND c on(a.brandCode= c.brandCode) 
	 <where>
	 	   <!-- 테스트 중 -->
	 	    <if test="gender != null">	
	 	 	  a.gender = #{gender}
	 	  	</if>
	 	   <!--  -->
		 <if test="paging.category != null">		 
		 	a.category = #{paging.category} 	
		 </if>
		 
		 <if test="paging.keyword !=null">
		 	 
			  a.prodCode LIKE '%'||#{paging.keyword}||'%' OR 
			  <!-- brand가 나중에 join하게 되면 추가 brandName LIKE '%'||#{paging.keyword}||'%' OR  -->
			  a.prodName LIKE '%'||#{paging.keyword}||'%' OR 
			  c.brandName LIKE '%'||#{paging.keyword}||'%' OR 
			  a.category LIKE '%'||#{paging.keyword}||'%' 
			  
		 </if>
		
		  
	 	  <if test="paging.sizeArray != null">
			 <foreach item="size" collection="paging.sizeArray" open="(" close=")" separator="OR">
		 			a.prodSize = CAST (#{size} AS INTEGER) 
			 </foreach>
			 
		  </if>
		
		
		 <if test="paging.colorArray != null ">
		 	<foreach item="color" collection="paging.colorArray" open="(" close=")" separator="OR">
				a.color= #{color}
			</foreach>
		 </if>
		 
		 <if test="paging.brandArray != null ">
		 	<foreach item="brand" collection="paging.brandArray" open="(" close=")" separator="OR">
				a.brandName= #{brand}
			</foreach>
		 </if>
		    
	 </where>
		 
	
	</select>


<!--4번째 mapper range범위의 최대값  -->
<select id="selectMaxPrice">
	 SELECT MAX(sellPrice) from SC_PRODUCTS a join SC_PRODUCTS_OPTION b on(a.prodCode  = b.prodCode) <!-- 사진 자료 생기면 쓰고 이거대신 옵션 테이블 --> 
								 join SC_BRAND c on(a.brandCode= c.brandCode) 
	 <where>
	 	 <!-- 테스트 중 -->
	 	  <if test="gender != null">	
	 	 	  a.gender = #{gender}
	 	  </if>
	 	 <!--  -->
	 
		 <if test="paging.category != null">		 
		 	a.category = #{paging.category} 	
		 </if>
		 
		 <if test="paging.keyword !=null">
		 	 
			  a.prodCode LIKE '%'||#{paging.keyword}||'%' OR 
			  <!-- brand가 나중에 join하게 되면 추가 brandName LIKE '%'||#{paging.keyword}||'%' OR  -->
			  a.prodName LIKE '%'||#{paging.keyword}||'%' OR 
			  c.brandName LIKE '%'||#{paging.keyword}||'%' OR 
			  a.category LIKE '%'||#{paging.keyword}||'%' 
			  
		 </if>
		
		  
	 	  <if test="paging.sizeArray != null">
			 <foreach item="size" collection="paging.sizeArray" open="(" close=")" separator="OR">
		 			a.prodSize = CAST (#{size} AS INTEGER) 
			 </foreach>
			 
		  </if>
		
		
		 <if test="paging.colorArray != null ">
		 	<foreach item="color" collection="paging.colorArray" open="(" close=")" separator="OR">
				a.color= #{color}
			</foreach>
		 </if>
		 
		 <if test="paging.brandArray != null ">
		 	<foreach item="brand" collection="paging.brandArray" open="(" close=")" separator="OR">
				a.brandName= #{brand}
			</foreach>
		 </if>
		    
	 </where>
		 
	
	</select>


</mapper>
